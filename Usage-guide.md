# Guides

## Install guides
### ALVR  
Install ALVR following the [guide](https://github.com/alvr-org/ALVR/wiki/Installation-guide#installation).  
The guide will also ask you to install SteamVR from [Steam](https://store.steampowered.com/app/250820/SteamVR/).  
You also need to install the apk for the VR headset.

### Clumsy  
Clumsy is a network tool where you can introduce artificial degradation, which is used to gather the user experience in situations where the network connection isn't always the best.

To download clumsy follow the link below.

Source: https://jagt.github.io/clumsy/

### Unity
Install Unity from https://unity.com/download.  
You can download the world with all the packages and plugins from [OneDrive](https://hrnl-my.sharepoint.com/:u:/g/personal/1076265_hr_nl/EVtfqe33RUpKsmvJhMwHRz4BFTMZuVYdMLfm8cn-beCxXA?e=Jx4ka9) you need a password and the link expires on the second of May (02-05-2025).

#### SteamVR plugin
You can download the SteamVR plugin from [AssetStore](https://assetstore.unity.com/packages/tools/integration/steamvr-plugin-32647).

#### Ultraleap Hap-E Haptics
You can follow the guide from [Ultraleap](https://docs.ultraleap.com/xr-and-tabletop/xr/unity/getting-started/index.html#set-up-hand-tracking-in-unity).  

### VPN for remote streaming
- A VPN of preferance can be installed, in this guide we will be using OpenVPN
- Installation setup
- 1. Install OpenVPN on the host (server)
- 2. Install OpenVPN on the client (VR headset/Phone) For this you will need to install the APK. On the phone you can download it on the playstore. In case of the headset this will need to be sideloaded
- Sideloading Guide for the VR Headset (Skip this if you use a phone)
- 1. Install Android Platform Tools on the host (https://developer.android.com/tools/releases/platform-tools)
- 2. Connect the client with an USB-C cable to the host. The client will have a popup where "File Transfer" needs to be pressed. If this doesnt happen you need to "Enable USB debugging and enable developer mode. Tutorials for this can be found online
- 3. Open the folder of the Android Platform Tools wich you just installed
- 4. Download the OpenVPN.apk wich can be downloaded from various sources
- 5. drop the OpenVPN.apk in the Android Platform Tools folder (It needs to be unzipped)
- 6. Open command prompt and in this folder (Example: C:\Downloads\platform-tools-latest-windows\platform-tools)
- 7. Run this command "adb install openvpn.apk" It should return installation succesfull
- Connecting the client and the host
- 1. Create or find a public VPN server of your liking. You can download these configuration files from various websites (.ovpn files) On the host you should open this file, OpenVPN will open and connect automatically after you have entered the username and password (these will be in the filename or on the website where you downloaded it)
- 2. In the file explorer you should see your client. Thereafter drag the .ovpn files into the downloads folder. After this run the OpenVPN app on your client. There should be a upload file button. Select the .ovpn file. Enter password and username, then connect
- Once both the Client and the Host are connected you are good to go and the setup is complete

---

## Usage guides
### ALVR
- Start ALVR
- Launch the needed version  
![](/Deliverables-P56/Images/launch-alvr.png)
- Click start SteamVR if it doesn't start automatically  
![](/Deliverables-P56/Images/steamvr-disconnect.png)
- Make sure the client and server are on the same network/VPN
- See if the client is in the autodiscovery otherwise ``Add Device Manually`` enter the hostname and ip that you see on the client(if you have opened the ALVR app there) and press ``save``. It should now autoconnect.
- The client should now automatically load into SteamVR and then you can start the Unity world if you want to by pressing the run button

### Clumsy
- Start Clumsy
- Select the preset "udp ipv4 against specific ip"  
![](/Deliverables-P56/Images/clumsy-preset.png)
- Enter the client IP found in ALVR fill in the "ip.DstAddr" and "ip.SrcAddr" with this ip  
![](/Deliverables-P56/Images/clumsy-ip.png)
- Press start and introduce the needed degradation  
![](/Deliverables-P56/Images/clumsy-start.png) 
  
### Logging script
When ALVR is running start the [alvr-socket.py](/scripts/alvr-socket.py) script, using ``py alvr-socket.py`` in the command line, and let it generate a log file.  
To close the script press ctrl+c twice in the terminal.

### Graphing script
To graph the data generated by the [logging script](#Logging-script), run the [json-to-graph.py](/scripts/json-to-graph.py) script and see the newly created .html file which contains the graphs, <b>be sure to give it another name before graphing a new json logging file, as it will overwrite it.</b>

### Downsize script
To downsize the data from the [logging script](#Logging-script), as it can be quite a big file for large sessions, you can run [downsize-json.py](/scripts/downsize-json.py) file which should be self explanatory.

### Unity Haptic delay
In the loaded Unity world, open the scenes folder and load the scene called minimal.  
Then Under ``minimal>Player>UltraleapDevice Left`` there should be an attached script called ``Custom Hap E Device Manager (Script)`` which has a parameter called ``Delay_in_seconds`` its default value is 0, and changing this should introduce more latency for the haptic feedback, you can see it on the bottom right of the following screenshot.  
![](/Deliverables-P56/Images/haptic-delay.png)

### Questionnaire
The questionnaire is used for turning the user experience into JSON data, such that it can be graphed by a script.  
You can follow the table below for filling in the values based on the experience.
| Question/Score                                            | 1                  | 2   | 3   | 4                          | 5   | 6   | 7                       | 8   | 9   | 10                          |
| --------------------------------------------------------- | ------------------ | --- | --- | -------------------------- | --- | --- | ----------------------- | --- | --- | --------------------------- |
| **How much have you used VR before**                      | Never              |     |     | A few times (1â€“3 times)    |     |     | Moderate use (weekly)   |     |     | Very frequently (daily)     |
| **Feeling (Motion sickness)**                             | Extremely nauseous |     |     | Noticeable discomfort      |     |     | Slight discomfort       |     |     | No discomfort at all        |
| **Can you still perform the same task you were doing?**   | Not at all         |     |     | Somewhat (50% effective)   |     |     | Mostly (75% effective)  |     |     | Completely (100% effective) |
| **How usable is it?**                                     | Not usable (0%)    |     |     | Partially usable (40%)     |     |     | Usable with ease (70%)  |     |     | Extremely usable (100%)     |
| **How accurate in the 2D/3D plane does the haptic feel?** | Does not work (0%) |     |     | Partially accurate (40%)   |     |     | Pretty accurate (70%)   |     |     | Extremely accurate (100%)   |
| **How responsive is the haptic feedback?**                | Does not work (0%) |     |     | Partially responsive (40%) |     |     | Pretty responsive (70%) |     |     | Extremely responsive (100%) |


---

## Exported data reading guides
### Logging script output
After running the VR session and closing the script there will be a folder named alvr-logs made with a json file inside with the statistics logs of that previous session.

It contains the following two entries:
- Statistics data per 1 ms
- Statistics Summary per 500 ms
#### Statistics data per 1 ms
```json
{ 
    "timestamp": "23:38:08.475", 
    "event_type": { 
        "id": "GraphStatistics", 
        "data": { 
            "total_pipeline_latency_s": 0.051938575, 
            "game_time_s": 0.0078286, 
            "server_compositor_s": 0.0001978, 
            "encoder_s": 0.0068522, 
            "network_s": 0.002433477, 
            "decoder_s": 0.010199115, 
            "decoder_queue_s": 0.022944732, 
            "client_compositor_s": 0.001482654, 
            "vsync_queue_s": 0.0, 
            "client_fps": 67.1885, 
            "server_fps": 60.442684, 
            "nominal_bitrate": { 
                "scaled_calculated_bps": null, 
                "decoder_latency_limiter_bps": null, 
                "network_latency_limiter_bps": null, 
                "encoder_latency_limiter_bps": null, 
                "manual_max_bps": null, 
                "manual_min_bps": null, 
                "requested_bps": 30000000.0 
            }, 
            "actual_bitrate_bps": 39449.727 
        } 
    } 
} 
```
##### Value explanation

- **total_pipeline_latency_s**: Total latency in seconds from the time a frame is generated to when it is displayed on the VR headset.
  - **game_time_s**: Time taken by the game engine to generate a frame.
  - **server_compositor_s**: Time taken by the server's compositor to process and prepare the graphics for encoding.
  - **encoder_s**: Time taken by the server encoder to compress the frame for network transmission.
  - **network_s**: Network latency, representing the time taken for the encoded frame data to be sent from the server to the client (VR headset).
  - **decoder_s**: Time taken by the client to decode the incoming compressed frame data.
  - **decoder_queue_s**: Time spent queuing the decoded frame before it is rendered. Longer queue times can indicate buffering delays.
  - **client_compositor_s**: Time spent by the client compositor to integrate the decoded frame with any overlays or UI elements before display.
  - **vsync_queue_s**: Time spent waiting for the VR headset's display to be ready for the next frame.
- **client_fps**: Frame rate at which the VR content is displayed on the client (headset).
- **server_fps**: Frame rate at which frames are generated by the server.
- **requested_bps**: The bitrate that the system requests which is here set to 30 mbps.
- **actual_bitrate_bps**: The actual bitrate achieved during data transmission, unsure is bps or kbps, we can assume it is kbps, because 39 kbps is very low, for VR streaming.

#### Statistics Summary per 500 ms
```json
{ 
    "timestamp": "23:38:08.959", 
    "event_type": { 
        "id": "StatisticsSummary", 
        "data": { 
            "video_packets_total": 84666, 
            "video_packets_per_sec": 60, 
            "video_mbytes_total": 23, 
            "video_mbits_per_sec": 0.00576, 
            "total_latency_ms": 52.106342, 
            "network_latency_ms": 2.3668852, 
            "encode_latency_ms": 7.4662, 
            "decode_latency_ms": 8.548883, 
            "packets_lost_total": 0, 
            "packets_lost_per_sec": 0, 
            "client_fps": 64, 
            "server_fps": 58, 
            "battery_hmd": 100, 
            "hmd_plugged": true 
        } 
    } 
} 
```
##### Value explanation
- **video_packets_total**: The total number of video packets sent so far. Here, 84,666 packets have been sent.
- **video_packets_per_sec**: The current rate of video packets sent per second, measured as 60 packets per second in this data.
- **video_mbytes_total**: The total amount of video data sent, measured in megabytes.
- **video_mbits_per_sec**: The transmission rate of video data in megabits per second.
- **packets_lost_total**: Total number of packets lost during transmission. 0 indicating no packet loss.
- **packets_lost_per_sec**: Number of packets lost per second.
- **battery_hmd**: Current battery level of the VR headset (HMD).
- **hmd_plugged**: Indicates whether the headset is plugged in (`true`) or running on battery (`false`). Here, it is `true`, meaning it is plugged in.

The other values which look the same as for the Statistics data, are the averages of those values.

### Graphs from JSON
Reading the data from the graph, number graphs left to right 1-5:
For word explanation see [Value explanation](#Value-explanation)
1. <b>Total and Network Latency Over Time</b>
  - Contains the total latency and specific network latency, during the test
2. <b>Client and Server Frame Rate Over Time</b>
  - Contains the Client(VR) fps and Server(Laptop) fps at any point during the test
3. <b>Bitrate Over Time</b>
  - Contains the Bitrate in MBps at any point during the test
4. <b>Client Frame Rate vs Network Latency</b>
  - Contains the Client fps as function of the Network latency
5. <b>Bitrate Mbps vs Network Latency</b>
  - Contains the Bitrate as function of the Network latency

#### Example
![](/Deliverables-P56/Images/graph-example.png)

### Questionnaire JSON output
Refer to [questionnaire usage guide](#Questionnaire) for the value explanations
